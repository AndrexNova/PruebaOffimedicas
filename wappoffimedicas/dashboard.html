<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Dashboard">
  <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <title>Dashio - Bootstrap Admin Template</title>

  <!-- Favicons -->
  <link href="img/favicon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Bootstrap core CSS -->
  <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!--external css-->
  <link href="lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="lib/bootstrap-datepicker/css/datepicker.css" />
  <link rel="stylesheet" type="text/css" href="lib/bootstrap-daterangepicker/daterangepicker.css" />
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">

  <!-- =======================================================
    Template Name: Dashio
    Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
    Author: TemplateMag.com
    License: https://templatemag.com/license/
  ======================================================= -->
</head>

<body>
  <section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
      <div class="sidebar-toggle-box">
        <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
      </div>
      <!--logo start-->
      <a href="index.html" class="logo"><b>Offimedicas</b></a>
      <!--logo end-->
      <div class="nav notify-row" id="top_menu">
       
        <!--  notification end -->
      </div>
      <div class="top-menu">
        <ul class="nav pull-right top-menu">
          <li><a class="logout"  onclick="logout()" >Logout</a></li>
        </ul>
      </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <!-- sidebar menu start-->
        <ul class="sidebar-menu" id="nav-accordion">
 
          <li class="mt">
            <a href="dashboard.html">
              <i class="fa fa-dashboard"></i>
              <span>Dashboard</span>
              </a>
          </li>
         
        </ul>
        <!-- sidebar menu end-->
      </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <h3><i class="fa fa-angle-right"></i> Núcleos Familiares</h3>
        <!-- BASIC FORM ELELEMNTS -->
        <div class="row mt">
          <div class="col-lg-12">
            <div class="form-panel">
              <h4 class="mb"><i class="fa fa-angle-right"></i>  Núcleos Familiares</h4>
              <form class="form-horizontal style-form" method="get">
			  
                <div class="form-group">
                  <label class="col-sm-2 col-sm-2 control-label">Nombres y Apellidos</label>
                  <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="Nombres y Apellidos" id="nombreApellidos">
                  </div>
	              <label class="col-sm-2 col-sm-2 control-label">Correo Electrónico</label>
                  <div class="col-sm-4">
                    <input type="email" class="form-control" placeholder="Correo Electronico" id="correoElectronico">
                  </div>
                </div>
				<div class="form-group">
				    <div class="col-sm-6">
						<label class="col-sm-6 col-sm-6 control-label">Parentesco</label>
						<select class="form-control" id="parentescosSelect">
						</select>
					</div>
					<div class="col-sm-6">
						<button type="button" class="btn btn-theme " 
								style=" float: right; margin: 2vh 10% 0 0;" 
								onclick="agregarNucleo(event)" >Agregar
						</button>
					</div>
				  </div>
              </form>
			  
			  
			<table id="parentescos" class="table table-hover custom-check">
                  <tbody  id ="tbodyParentescos">
 
                  </tbody>
                </table>
            </div>
			
			

          </div>
		  
		  
		  
		  
          <!-- col-lg-12-->
        </div>
		


      </section>
      <!-- /wrapper -->
    </section>
    <!-- /MAIN CONTENT -->
    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
      <div class="text-center">

      </div>
    </footer>
    <!--footer end-->
  </section>
  <!-- js placed at the end of the document so the pages load faster -->
  <script src="lib/jquery/jquery.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="lib/jquery.scrollTo.min.js"></script>
  <script src="lib/jquery.nicescroll.js" type="text/javascript"></script>
  <!--common script for all pages-->
  <script src="lib/common-scripts.js"></script>
  <!--script for this page-->
  <script src="lib/jquery-ui-1.9.2.custom.min.js"></script>
  <!--custom switch-->
  <script src="lib/bootstrap-switch.js"></script>
  <!--custom tagsinput-->
  <script src="lib/jquery.tagsinput.js"></script>
  <!--custom checkbox & radio-->
  <script type="text/javascript" src="lib/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
  <script type="text/javascript" src="lib/bootstrap-daterangepicker/date.js"></script>
  <script type="text/javascript" src="lib/bootstrap-daterangepicker/daterangepicker.js"></script>
  <script type="text/javascript" src="lib/bootstrap-inputmask/bootstrap-inputmask.min.js"></script>
  <script src="lib/form-component.js"></script> 
 <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  
  <script src="lib/axios.min.js"></script>

	
  <script>
 	
	if(localStorage.getItem('usuario')==null){
						window.location.href="login.html";

	}
	
	
	listarNucleo();
	listarParentescos();
	
	
	
	
	
	
	
	function logout() {
		window.localStorage.clear();
		window.location.href="login.html";
	}
	
	function agregarNucleo(e){
		e.preventDefault();
		agregarParienteUsuario();
		
	}
	
	function agregarParentesco(idPariente){

		axios.post(getVariables().URLWS+'nucleos', {	
				"idusuarioppal":JSON.parse( localStorage.getItem('usuario')).id,
				"idusuarionucleo":idPariente,
				"idparentesco":document.getElementById("parentescosSelect").value,
		 headers: {
					'Content-Type': 'application/json'
				}
		})
		.then(function(res) {
			console.log(res.data.code) 
			if(res.data.code == "200"){
						listarNucleo();

			}else{
				alert("Núcleo no Creado: "+res.data.msg);
			}
		})
		.catch(function(err) {
		  console.log(err);
		})
	}
	
	
	function agregarParienteUsuario(){
		var nombreApellidos = document.getElementById("nombreApellidos").value;
		var correoElectronico = document.getElementById("correoElectronico").value;
		
		if(!validarEmail(correoElectronico)){
			alert("No es un correo valido");
			return ;
		}
		
		axios.post(getVariables().URLWS+'usuarios', {
	
				"name":nombreApellidos,
				"email":correoElectronico,
				"password":correoElectronico,
				
		 headers: {
					'Content-Type': 'application/json'
				}
		})
		.then(function(res) {
			console.log(res.data.code) 
			if(res.data.code == "200" || res.data.code == "201"){
				document.getElementById("nombreApellidos").value = "";
				document.getElementById("correoElectronico").value = "";
				agregarParentesco(res.data.data.id);
			}else{

				alert("Núcleo no Creado");
			}
		})
		.catch(function(err) {
		  console.log(err);
		})
	}
	
	function eliminarNucleo(idNucleo){
		axios.delete(getVariables().URLWS+'nucleos/'+idNucleo, {
		 headers: {
					'Content-Type': 'application/json'
				}
		})
		.then(function(res) {
			console.log(res.data.code) 
			if(res.data.code == "200"){
					alert("Núcleo Eliminado");
					listarNucleo();

			}else{
				alert(res.data.msg);
			}
		})
		.catch(function(err) {
		  console.log(err);
		})
	}
	
	function listarNucleo(){

		axios.get(getVariables().URLWS+'usuariosnucleaos/'+JSON.parse( localStorage.getItem('usuario')).id, {
		 headers: {
					'Content-Type': 'application/json'
				}
		})
		.then(function(res) {
			console.log(res.data.code) 
			if(res.data.code == "200"){
				document.getElementById("tbodyParentescos").html="";
				
				html="";
				for (var i = 0; i < res.data.data.length; i++) {
					html+="<tr>"+
                      "<td>"+
                        "<span class='check'></span>"+
                        "<a href='#'>"+res.data.data[i].nombreusuario+"</a></span>"+
                      "</td>"+
                      "<td>"+
                        "<span class='check'></span>"+
                        "<a href='#'>"+res.data.data[i].email+"</a></span>"+
                      "</td>"+
					   "<td>"+
                        "<span class='check'></span>"+
                        "<a href='#'>"+res.data.data[i].parentesconombre+"</a></span>"+
                      "</td>"+
					  "<td>"+
                        " <button class='close' aria-hidden='true' data-dismiss='alert' "+
						" onclick=\"eliminarNucleo("+res.data.data[i].idnucleo+")\" type='button'>×</button>"+
                      "</td>"+
                    "</tr>";
				}
				document.getElementById("tbodyParentescos").innerHTML =html;		
			}else{
				alert("Núcleo no Creado");
			}
		})
		.catch(function(err) {
		  console.log(err);
		})
	}
	
  	function listarParentescos(){

		axios.get(getVariables().URLWS+'parentescos', {
		 headers: {
					'Content-Type': 'application/json'
				}
		})
		.then(function(res) {
			console.log(res.data.code) 
			if(res.data.code == "200"){
				document.getElementById("parentescosSelect").html="";
				
				html="";
				for (var i = 0; i < res.data.data.length; i++) {
					html+="<option value='"+res.data.data[i].id+"'>"+res.data.data[i].name+"</option>";
				}
				document.getElementById("parentescosSelect").innerHTML =html;		
			}else{
				alert("Núcleo no Creado");
			}
		})
		.catch(function(err) {
		  console.log(err);
		})
	}
	


  </script>
</body>
</html>
